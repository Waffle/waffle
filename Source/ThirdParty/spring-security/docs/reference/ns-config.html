<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>2.&nbsp;Security Namespace Configuration</title><link rel="stylesheet" href="css/manual.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="springsecurity.html" title="Spring Security"><link rel="up" href="getting-started.html" title="Part&nbsp;I.&nbsp;Getting Started"><link rel="prev" href="introduction.html" title="1.&nbsp;Introduction"><link rel="next" href="sample-apps.html" title="3.&nbsp;Sample Applications"><!--Begin Google Analytics code--><script type="text/javascript">
			var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
			document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		</script><script type="text/javascript">
			var pageTracker = _gat._getTracker("UA-2728886-3");
			pageTracker._setDomainName("none");
			pageTracker._setAllowLinker(true);
			pageTracker._trackPageview();
		</script><!--End Google Analytics code--></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.&nbsp;Security Namespace Configuration</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="introduction.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;I.&nbsp;Getting Started</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="sample-apps.html">Next</a></td></tr></table><hr></div><div class="chapter" title="2.&nbsp;Security Namespace Configuration"><div class="titlepage"><div><div><h2 class="title"><a name="ns-config"></a>2.&nbsp;Security Namespace Configuration</h2></div></div></div>
  
  <div class="section" title="2.1&nbsp;Introduction"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4e195"></a>2.1&nbsp;Introduction</h2></div></div></div>
    
    <p> Namespace configuration has been available since version 2.0 of the Spring framework. It
      allows you to supplement the traditional Spring beans application context syntax with elements
      from additional XML schema. You can find more information in the Spring <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/apc.html" target="_top"> Reference Documentation</a>. A namespace element can be used simply to allow a more
      concise way of configuring an individual bean or, more powerfully, to define an alternative
      configuration syntax which more closely matches the problem domain and hides the underlying
      complexity from the user. A simple element may conceal the fact that multiple beans and
      processing steps are being added to the application context. For example, adding the following
      element from the security namespace to an application context will start up an embedded LDAP
      server for testing use within the application: </p><pre class="programlisting">
  <span class="hl-tag">&lt;security:ldap-server /&gt;</span>
</pre><p> This is much simpler than wiring up the equivalent Apache Directory Server
      beans. The most common alternative configuration requirements are supported by attributes on
      the <code class="literal">ldap-server</code> element and the user is isolated from worrying about which
      beans they need to create and what the bean property names are. <sup>[<a name="d4e201" href="#ftn.d4e201" class="footnote">1</a>]</sup>. Use of a good XML editor while
      editing the application context file should provide information on the attributes and elements
      that are available. We would recommend that you try out the <a class="ulink" href="http://www.springsource.com/products/sts" target="_top">SpringSource Tool Suite</a> as it
      has special features for working with standard Spring namespaces. </p>
    <p> To start using the security namespace in your application context, you first need to make
        sure that the <code class="literal">spring-security-config</code> jar is on your classpath. Then all you need to do is
      add the schema declaration to your application context file: </p><pre class="programlisting">
  
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
  <span class="hl-attribute">xmlns:security</span>=<span class="hl-value">"http://www.springframework.org/schema/security"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
          http://www.springframework.org/schema/security
          http://www.springframework.org/schema/security/spring-security-3.0.3.xsd"</span><span class="hl-tag">&gt;</span>
    ...
<span class="hl-tag">&lt;/beans&gt;</span>
  </pre><p> In many of the examples you will see (and in the sample) applications, we
      will often use "security" as the default namespace rather than "beans", which means we can
      omit the prefix on all the security namespace elements, making the content easier to read. You
      may also want to do this if you have your application context divided up into separate files
      and have most of your security configuration in one of them. Your security application context
      file would then start like this </p><pre class="programlisting">
<span class="hl-tag">&lt;beans:beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/security"</span>
  <span class="hl-attribute">xmlns:beans</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
           http://www.springframework.org/schema/security
           http://www.springframework.org/schema/security/spring-security-3.0.3.xsd"</span><span class="hl-tag">&gt;</span>
    ...
<span class="hl-tag">&lt;/beans:beans&gt;</span>
</pre><p> We'll assume this syntax is being used from now on in this chapter. </p>
    <div class="section" title="2.1.1&nbsp;Design of the Namespace"><div class="titlepage"><div><div><h3 class="title"><a name="d4e210"></a>2.1.1&nbsp;Design of the Namespace</h3></div></div></div>
      
      <p> The namespace is designed to capture the most common uses of the framework and provide
        a simplified and concise syntax for enabling them within an application. The design is based
        around the large-scale dependencies within the framework, and can be divided up into the
        following areas: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              <span class="emphasis"><em>Web/HTTP Security</em></span> - the most complex part. Sets up the filters
              and related service beans used to apply the framework authentication mechanisms, to
              secure URLs, render login and error pages and much
              more.</p></li><li class="listitem"><p>
              <span class="emphasis"><em>Business Object (Method) Security</em></span> - options for securing the
              service layer.</p></li><li class="listitem"><p>
              <span class="emphasis"><em>AuthenticationManager</em></span> - handles authentication requests from
              other parts of the framework.</p></li><li class="listitem"><p>
              <span class="emphasis"><em>AccessDecisionManager</em></span> - provides access decisions for web and
              method security. A default one will be registered, but you can also choose to use a
              custom one, declared using normal Spring bean
              syntax.</p></li><li class="listitem"><p>
              <span class="emphasis"><em>AuthenticationProvider</em></span>s - mechanisms against which the
              authentication manager authenticates users. The namespace provides supports for
              several standard options and also a means of adding custom beans declared using a
              traditional syntax. </p></li><li class="listitem"><p>
              <span class="emphasis"><em>UserDetailsService</em></span> - closely related to authentication providers,
              but often also required by other beans.</p></li></ul></div>
      <p>We'll see how to configure these in the following sections.</p>
    </div>
  </div>
  <div class="section" title="2.2&nbsp;Getting Started with Security Namespace Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ns-getting-started"></a>2.2&nbsp;Getting Started with Security Namespace Configuration</h2></div></div></div>
    
    <p> In this section, we'll look at how you can build up a namespace configuration to use some
      of the main features of the framework. Let's assume you initially want to get up and running
      as quickly as possible and add authentication support and access control to an existing web
      application, with a few test logins. Then we'll look at how to change over to authenticating
      against a database or other security repository. In later sections we'll introduce more
      advanced namespace configuration options. </p>
    <div class="section" title="2.2.1&nbsp;web.xml Configuration"><div class="titlepage"><div><div><h3 class="title"><a name="ns-web-xml"></a>2.2.1&nbsp;<code class="literal">web.xml</code> Configuration</h3></div></div></div>
      
      <p> The first thing you need to do is add the following filter declaration to your
          <code class="literal">web.xml</code> file: </p><pre class="programlisting">
<span class="hl-tag">&lt;filter&gt;</span>
  <span class="hl-tag">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="hl-tag">&lt;/filter-name&gt;</span>
  <span class="hl-tag">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="hl-tag">&lt;/filter-class&gt;</span>
<span class="hl-tag">&lt;/filter&gt;</span>

<span class="hl-tag">&lt;filter-mapping&gt;</span>
  <span class="hl-tag">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="hl-tag">&lt;/filter-name&gt;</span>
  <span class="hl-tag">&lt;url-pattern&gt;</span>/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
<span class="hl-tag">&lt;/filter-mapping&gt;</span>
      </pre><p> This provides a hook into the Spring Security web
        infrastructure. <code class="classname">DelegatingFilterProxy</code> is a Spring Framework class
        which delegates to a filter implementation which is defined as a Spring bean in your
        application context. In this case, the bean is named
          <span class="quote">&#8220;<span class="quote">springSecurityFilterChain</span>&#8221;</span>, which is an internal infrastructure bean created
        by the namespace to handle web security. Note that you should not use this bean name
        yourself. Once you've added this to your <code class="filename">web.xml</code>, you're ready to start
        editing your application context file. Web security services are configured using the
          <code class="literal">&lt;http&gt;</code> element. </p>
    </div>
    <div class="section" title="2.2.2&nbsp;A Minimal <http&gt; Configuration"><div class="titlepage"><div><div><h3 class="title"><a name="ns-minimal"></a>2.2.2&nbsp;A Minimal <code class="literal">&lt;http&gt;</code> Configuration</h3></div></div></div>
      
      <p> All you need to enable web security to begin with is </p><pre class="programlisting">
  <span class="hl-tag">&lt;http</span> <span class="hl-attribute">auto-config</span>=<span class="hl-value">'true'</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/**"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;/http&gt;</span>
  
</pre><p> Which says that we want all URLs within our application to be secured,
        requiring the role <code class="literal">ROLE_USER</code> to access them. The
          <code class="literal">&lt;http&gt;</code> element is the parent for all web-related namespace
        functionality. The <code class="literal">&lt;intercept-url&gt;</code> element defines a
          <code class="literal">pattern</code> which is matched against the URLs of incoming requests using an
        ant path style syntax. The <code class="literal">access</code> attribute defines the access
        requirements for requests matching the given pattern. With the default configuration, this
        is typically a comma-separated list of roles, one of which a user must have to be allowed to
        make the request. The prefix <span class="quote">&#8220;<span class="quote">ROLE_</span>&#8221;</span> is a marker which indicates that a simple
        comparison with the user's authorities should be made. In other words, a normal role-based
        check should be used. Access-control in Spring Security is not limited to the use of simple
        roles (hence the use of the prefix to differentiate between different types of security
        attributes). We'll see later how the interpretation can vary<sup>[<a name="d4e257" href="#ftn.d4e257" class="footnote">2</a>]</sup>.</p>
      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
        <p>You can use multiple <code class="literal">&lt;intercept-url&gt;</code> elements to define
          different access requirements for different sets of URLs, but they will be evaluated in
          the order listed and the first match will be used. So you must put the most specific
          matches at the top. You can also add a <code class="literal">method</code> attribute to limit the
          match to a particular HTTP method (<code class="literal">GET</code>, <code class="literal">POST</code>,
            <code class="literal">PUT</code> etc.). If a request matches multiple patterns, the
          method-specific match will take precedence regardless of ordering.</p>
      </td></tr></table></div>
      <p> To add some users, you can define a set of test data directly in the namespace: </p><pre class="programlisting">
  <span class="hl-tag">&lt;authentication-manager&gt;</span>
    <span class="hl-tag">&lt;authentication-provider&gt;</span>
      <span class="hl-tag">&lt;user-service&gt;</span>
        <span class="hl-tag">&lt;user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jimi"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"jimispassword"</span> <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER, ROLE_ADMIN"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bob"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"bobspassword"</span> <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
      <span class="hl-tag">&lt;/user-service&gt;</span>
    <span class="hl-tag">&lt;/authentication-provider&gt;</span>
  <span class="hl-tag">&lt;/authentication-manager&gt;</span>
  
        </pre>
      <div class="sidebar"><p class="title"><b></b></p>
        <p>If you are familiar with pre-namespace versions of the framework, you can probably
          already guess roughly what's going on here. The <code class="literal">&lt;http&gt;</code> element is
          responsible for creating a <code class="classname">FilterChainProxy</code> and the filter beans
          which it uses. Common problems like incorrect filter ordering are no longer an issue as
          the filter positions are predefined.</p>
        <p>The <code class="literal">&lt;authentication-provider&gt;</code> element creates a
            <code class="classname">DaoAuthenticationProvider</code> bean and the
            <code class="literal">&lt;user-service&gt;</code> element creates an
            <code class="classname">InMemoryDaoImpl</code>. All <code class="literal">authentication-provider</code>
          elements must be children of the <code class="literal">&lt;authentication-manager&gt;</code> element,
          which creates a <code class="classname">ProviderManager</code> and registers the authentication
          providers with it. You can find more detailed information on the beans that are created in
          the <a class="ulink" href="#appendix-namespace" target="_top">namespace appendix</a>. It's worth
          cross-checking this if you want to start understanding what the important classes in the
          framework are and how they are used, particularly if you want to customise things
          later.</p>
      </div>
      <p> The configuration above defines two users, their passwords and their roles within the
        application (which will be used for access control). It is also possible to load user
        information from a standard properties file using the <code class="literal">properties</code>
        attribute on <code class="literal">user-service</code>. See the section on <a class="ulink" href="#core-services-in-memory-service" target="_top">in-memory authentication</a> for more
        details on the file format. Using the <code class="literal">&lt;authentication-provider&gt;</code>
        element means that the user information will be used by the authentication manager to
        process authentication requests. You can have multiple
          <code class="literal">&lt;authentication-provider&gt;</code> elements to define different
        authentication sources and each will be consulted in turn.</p>
      <p> At this point you should be able to start up your application and you will be required
        to log in to proceed. Try it out, or try experimenting with the <span class="quote">&#8220;<span class="quote">tutorial</span>&#8221;</span>
        sample application that comes with the project. The above configuration actually adds quite
        a few services to the application because we have used the <code class="literal">auto-config</code>
        attribute. For example, form-based login processing is automatically enabled. </p>
      <div class="section" title="What does auto-config Include?"><div class="titlepage"><div><div><h4 class="title"><a name="ns-auto-config"></a>What does <code class="literal">auto-config</code> Include?</h4></div></div></div>
        
        <p> The <code class="literal">auto-config</code> attribute, as we have used it above, is just a
          shorthand syntax for: </p><pre class="programlisting">
  <span class="hl-tag">&lt;http&gt;</span>
    <span class="hl-tag">&lt;form-login /&gt;</span>
    <span class="hl-tag">&lt;http-basic /&gt;</span>
    <span class="hl-tag">&lt;logout /&gt;</span>
  <span class="hl-tag">&lt;/http&gt;</span>
  </pre><p> These other elements are responsible for setting up form-login, basic
          authentication and logout handling services respectively <sup>[<a name="d4e299" href="#ftn.d4e299" class="footnote">3</a>]</sup> . They each have attributes which can be used to alter
          their behaviour. </p>
      </div>
      <div class="section" title="Form and Basic Login Options"><div class="titlepage"><div><div><h4 class="title"><a name="ns-form-and-basic"></a>Form and Basic Login Options</h4></div></div></div>
        
        <p> You might be wondering where the login form came from when you were prompted to log
          in, since we made no mention of any HTML files or JSPs. In fact, since we didn't
          explicitly set a URL for the login page, Spring Security generates one automatically,
          based on the features that are enabled and using standard values for the URL which
          processes the submitted login, the default target URL the user will be sent to after
          loggin in and so on. However, the namespace offers plenty of support to allow you to
          customize these options. For example, if you want to supply your own login page, you could
          use: </p><pre class="programlisting">
  <span class="hl-tag">&lt;http</span> <span class="hl-attribute">auto-config</span>=<span class="hl-value">'true'</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/login.jsp*"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"IS_AUTHENTICATED_ANONYMOUSLY"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/**"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;form-login</span> <span class="hl-attribute">login-page</span>=<span class="hl-value">'/login.jsp'</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/http&gt;</span>
  
        </pre><p> Note that you can still use <code class="literal">auto-config</code>. The
            <code class="literal">form-login</code> element just overrides the default settings. Also note
          that we've added an extra <code class="literal">intercept-url</code> element to say that any
          requests for the login page should be available to anonymous users <sup>[<a name="d4e312" href="#ftn.d4e312" class="footnote">4</a>]</sup>. Otherwise the request would be matched by the pattern
            <code class="literal">/**</code> and it wouldn't be possible to access the login page itself! This
          is a common configuration error and will result in an infinite loop in the application.
          Spring Security will emit a warning in the log if your login page appears to be secured.
          It is also possible to have all requests matching a particular pattern bypass the security
          filter chain completely: </p><pre class="programlisting">
  <span class="hl-tag">&lt;http</span> <span class="hl-attribute">auto-config</span>=<span class="hl-value">'true'</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/css/**"</span> <span class="hl-attribute">filters</span>=<span class="hl-value">"none"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/login.jsp*"</span> <span class="hl-attribute">filters</span>=<span class="hl-value">"none"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/**"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;form-login</span> <span class="hl-attribute">login-page</span>=<span class="hl-value">'/login.jsp'</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/http&gt;</span>
  
          </pre><p>It's important to realise that these requests will be completely
          oblivious to any further Spring Security web-related configuration or additional
          attributes such as <code class="literal">requires-channel</code>, so you will not be able to access
          information on the current user or call secured methods during the request. Use
            <code class="literal">access='IS_AUTHENTICATED_ANONYMOUSLY'</code> as an alternative if you still
          want the security filter chain to be applied.</p>
        <p>If you want to use basic authentication instead of form login, then change the
          configuration to </p><pre class="programlisting">
  <span class="hl-tag">&lt;http</span> <span class="hl-attribute">auto-config</span>=<span class="hl-value">'true'</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/**"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;http-basic /&gt;</span>
  <span class="hl-tag">&lt;/http&gt;</span>
  
        </pre><p> Basic authentication will then take precedence and will be used to
          prompt for a login when a user attempts to access a protected resource. Form login is
          still available in this configuration if you wish to use it, for example through a login
          form embedded in another web page. </p>
        <div class="section" title="Setting a Default Post-Login Destination"><div class="titlepage"><div><div><h5 class="title"><a name="ns-form-target"></a>Setting a Default Post-Login Destination</h5></div></div></div>
          
          <p> If a form login isn't prompted by an attempt to access a protected resource, the
              <code class="literal">default-target-url</code> option comes into play. This is the URL the user
            will be taken to after logging in, and defaults to "/". You can also configure things so
            that they user <span class="emphasis"><em>always</em></span> ends up at this page (regardless of whether
            the login was "on-demand" or they explicitly chose to log in) by setting the
              <code class="literal">always-use-default-target</code> attribute to "true". This is useful if
            your application always requires that the user starts at a "home" page, for example: </p><pre class="programlisting">
  <span class="hl-tag">&lt;http&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">'/login.htm*'</span> <span class="hl-attribute">filters</span>=<span class="hl-value">'none'</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">'/**'</span> <span class="hl-attribute">access</span>=<span class="hl-value">'ROLE_USER'</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;form-login</span> <span class="hl-attribute">login-page</span>=<span class="hl-value">'/login.htm'</span> <span class="hl-attribute">default-target-url</span>=<span class="hl-value">'/home.htm'</span>
            <span class="hl-attribute">always-use-default-target</span>=<span class="hl-value">'true'</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;/http&gt;</span>
  
            </pre>
        </div>
      </div>
    </div>
    <div class="section" title="2.2.3&nbsp;Using other Authentication Providers"><div class="titlepage"><div><div><h3 class="title"><a name="ns-auth-providers"></a>2.2.3&nbsp;Using other Authentication Providers</h3></div></div></div>
      
      <p> In practice you will need a more scalable source of user information than a few names
        added to the application context file. Most likely you will want to store your user
        information in something like a database or an LDAP server. LDAP namespace configuration is
        dealt with in the <a class="ulink" href="#ldap" target="_top">LDAP chapter</a>, so we won't cover it here.
        If you have a custom implementation of Spring Security's
          <code class="classname">UserDetailsService</code>, called "myUserDetailsService" in your
        application context, then you can authenticate against this using </p><pre class="programlisting">
  <span class="hl-tag">&lt;authentication-manager&gt;</span>
    <span class="hl-tag">&lt;authentication-provider</span> <span class="hl-attribute">user-service-ref</span>=<span class="hl-value">'myUserDetailsService'</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/authentication-manager&gt;</span>
  
        </pre><p> If you want to use a database, then you can use </p><pre class="programlisting">
  <span class="hl-tag">&lt;authentication-manager&gt;</span>
    <span class="hl-tag">&lt;authentication-provider&gt;</span>
      <span class="hl-tag">&lt;jdbc-user-service</span> <span class="hl-attribute">data-source-ref</span>=<span class="hl-value">"securityDataSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/authentication-provider&gt;</span>
  <span class="hl-tag">&lt;/authentication-manager&gt;</span>
  
        </pre><p> Where <span class="quote">&#8220;<span class="quote">securityDataSource</span>&#8221;</span> is the name of a
          <code class="classname">DataSource</code> bean in the application context, pointing at a database
        containing the standard Spring Security <a class="ulink" href="#db_schema_users_authorities" target="_top">user
          data tables</a>. Alternatively, you could configure a Spring Security
          <code class="classname">JdbcDaoImpl</code> bean and point at that using the
          <code class="literal">user-service-ref</code> attribute: </p><pre class="programlisting">
  <span class="hl-tag">&lt;authentication-manager&gt;</span>
    <span class="hl-tag">&lt;authentication-provider</span> <span class="hl-attribute">user-service-ref</span>=<span class="hl-value">'myUserDetailsService'</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/authentication-manager&gt;</span>

  <span class="hl-tag">&lt;beans:bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myUserDetailsService"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.core.userdetails.jdbc.JdbcDaoImpl"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;beans:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/beans:bean&gt;</span>
  
        </pre><p> You can also use standard
          <code class="interfacename">AuthenticationProvider</code> beans as follows </p><pre class="programlisting">
  <span class="hl-tag">&lt;authentication-manager&gt;</span>
    <span class="hl-tag">&lt;authentication-provider</span> <span class="hl-attribute">ref</span>=<span class="hl-value">'myAuthenticationProvider'</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/authentication-manager&gt;</span>
  
        </pre><p> where <code class="literal">myAuthenticationProvider</code> is the name of a
        bean in your application context which implements
          <code class="interfacename">AuthenticationProvider</code>. You can use multiple
          <code class="literal">authentication-provider</code> elements, in which case they will be checked
        in the order they are declared when attempting to authenticated a user. See <a class="xref" href="ns-config.html#ns-auth-manager" title="2.6&nbsp;The Authentication Manager and the Namespace">Section&nbsp;2.6, &#8220;The Authentication Manager and the Namespace&#8221;</a> for more on information on how the Spring Security
          <code class="interfacename">AuthenticationManager</code> is configured using the namespace. </p>
      <div class="section" title="Adding a Password Encoder"><div class="titlepage"><div><div><h4 class="title"><a name="ns-password-encoder"></a>Adding a Password Encoder</h4></div></div></div>
        
        <p> Often your password data will be encoded using a hashing algorithm. This is supported
          by the <code class="literal">&lt;password-encoder&gt;</code> element. With SHA encoded passwords,
          the original authentication provider configuration would look like this: </p><pre class="programlisting">
<span class="hl-tag">&lt;authentication-manager&gt;</span>
  <span class="hl-tag">&lt;authentication-provider&gt;</span>
    <span class="hl-tag">&lt;password-encoder</span> <span class="hl-attribute">hash</span>=<span class="hl-value">"sha"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;user-service&gt;</span>
      <span class="hl-tag">&lt;user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jimi"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"d7e6351eaa13189a5a3641bab846c8e8c69ba39f"</span>
            <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER, ROLE_ADMIN"</span><span class="hl-tag"> /&gt;</span>
      <span class="hl-tag">&lt;user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bob"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"4e7421b1b8765d8f9406d87e7cc6aa784c4ab97f"</span>
            <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/user-service&gt;</span>
  <span class="hl-tag">&lt;/authentication-provider&gt;</span>
<span class="hl-tag">&lt;/authentication-manager&gt;</span>
  
          </pre>
        <p> When using hashed passwords, it's also a good idea to use a salt value to protect
          against dictionary attacks and Spring Security supports this too. Ideally you would want
          to use a randomly generated salt value for each user, but you can use any property of the
            <code class="classname">UserDetails</code> object which is loaded by your
            <code class="classname">UserDetailsService</code>. For example, to use the
            <code class="literal">username</code> property, you would use </p><pre class="programlisting">
  &lt;password-encoder hash="sha"&gt;
    &lt;salt-source user-property="username"/&gt;
  &lt;/password-encoder&gt;
    </pre><p> You can use a custom password encoder bean by using the
            <code class="literal">ref</code> attribute of <code class="literal">password-encoder</code>. This should
          contain the name of a bean in the application context which is an instance of Spring
          Security's <code class="interfacename">PasswordEncoder</code> interface. </p>
      </div>
    </div>
  </div>
  <div class="section" title="2.3&nbsp;Advanced Web Features"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ns-web-advanced"></a>2.3&nbsp;Advanced Web Features</h2></div></div></div>
    
    <div class="section" title="2.3.1&nbsp;Remember-Me Authentication"><div class="titlepage"><div><div><h3 class="title"><a name="ns-remember-me"></a>2.3.1&nbsp;Remember-Me Authentication</h3></div></div></div>
      
      <p>See the separate <a class="ulink" href="#remember-me" target="_top">Remember-Me chapter</a> for
        information on remember-me namespace configuration.</p>
    </div>
    <div class="section" title="2.3.2&nbsp;Adding HTTP/HTTPS Channel Security"><div class="titlepage"><div><div><h3 class="title"><a name="ns-requires-channel"></a>2.3.2&nbsp;Adding HTTP/HTTPS Channel Security</h3></div></div></div>
      
      <p>If your application supports both HTTP and HTTPS, and you require that particular URLs
        can only be accessed over HTTPS, then this is directly supported using the
          <code class="literal">requires-channel</code> attribute on <code class="literal">&lt;intercept-url&gt;</code>: </p><pre class="programlisting">
  <span class="hl-tag">&lt;http&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/secure/**"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_USER"</span> <span class="hl-attribute">requires-channel</span>=<span class="hl-value">"https"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/**"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_USER"</span> <span class="hl-attribute">requires-channel</span>=<span class="hl-value">"any"</span><span class="hl-tag">/&gt;</span>
    ...
  <span class="hl-tag">&lt;/http&gt;</span>
        </pre><p>With this configuration in place, if a user attempts to access
        anything matching the "/secure/**" pattern using HTTP, they will first be redirected to an
        HTTPS URL. The available options are "http", "https" or "any". Using the value "any" means
        that either HTTP or HTTPS can be used. </p>
      <p>If your application uses non-standard ports for HTTP and/or HTTPS, you can specify a
        list of port mappings as follows: </p><pre class="programlisting">
  &lt;http&gt;
    ...
    &lt;port-mappings&gt;
      &lt;port-mapping http="9080" https="9443"/&gt;
    &lt;/port-mappings&gt;
  &lt;/http&gt;
        </pre>
    </div>
    <div class="section" title="2.3.3&nbsp;Session Management"><div class="titlepage"><div><div><h3 class="title"><a name="ns-session-mgmt"></a>2.3.3&nbsp;Session Management</h3></div></div></div>
      
      <div class="section" title="Detecting Timeouts"><div class="titlepage"><div><div><h4 class="title"><a name="d4e379"></a>Detecting Timeouts</h4></div></div></div>
        
        <p> You can configure Spring Security to detect the submission of an invalid session ID
          and redirect the user to an appropriate URL. This is achieved through the
            <code class="literal">session-management</code> element: </p><pre class="programlisting">
  <span class="hl-tag">&lt;http&gt;</span>
    ...
    <span class="hl-tag">&lt;session-management</span> <span class="hl-attribute">invalid-session-url</span>=<span class="hl-value">"/sessionTimeout.htm"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;/http&gt;</span></pre>
      </div>
      <div class="section" title="Concurrent Session Control"><div class="titlepage"><div><div><h4 class="title"><a name="ns-concurrent-sessions"></a>Concurrent Session Control</h4></div></div></div>
        
        <p>If you wish to place constraints on a single user's ability to log in to your
          application, Spring Security supports this out of the box with the following simple
          additions. First you need to add the following listener to your
            <code class="filename">web.xml</code> file to keep Spring Security updated about session
          lifecycle events: </p><pre class="programlisting">
  <span class="hl-tag">&lt;listener&gt;</span>
    <span class="hl-tag">&lt;listener-class&gt;</span>
      org.springframework.security.web.session.HttpSessionEventPublisher
    <span class="hl-tag">&lt;/listener-class&gt;</span>
  <span class="hl-tag">&lt;/listener&gt;</span>
</pre><p> Then add the following lines to your application context: </p><pre class="programlisting">
  <span class="hl-tag">&lt;http&gt;</span>
    ...
    <span class="hl-tag">&lt;session-management&gt;</span>
        <span class="hl-tag">&lt;concurrency-control</span> <span class="hl-attribute">max-sessions</span>=<span class="hl-value">"1"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/session-management&gt;</span>
  <span class="hl-tag">&lt;/http&gt;</span>
        </pre><p> This will prevent a user from logging in multiple times - a
          second login will cause the first to be invalidated. Often you would prefer to prevent a
          second login, in which case you can use </p><pre class="programlisting">
  <span class="hl-tag">&lt;http&gt;</span>
    ...
    <span class="hl-tag">&lt;session-management&gt;</span>
        <span class="hl-tag">&lt;concurrency-control</span> <span class="hl-attribute">max-sessions</span>=<span class="hl-value">"1"</span> <span class="hl-attribute">error-if-maximum-exceeded</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/session-management&gt;</span>
  <span class="hl-tag">&lt;/http&gt;</span>
        </pre><p>The second login will then be rejected. By
            <span class="quote">&#8220;<span class="quote">rejected</span>&#8221;</span>, we mean that the user will be sent to the
            <code class="literal">authentication-failure-url</code> if form-based login is being used. If the
          second authentication takes place through another non-interactive mechanism, such as
            <span class="quote">&#8220;<span class="quote">remember-me</span>&#8221;</span>, an <span class="quote">&#8220;<span class="quote">unauthorized</span>&#8221;</span> (402) error will be sent to
          the client. If instead you want to use an error page, you can add the attribute
            <code class="literal">session-authentication-error-url</code> to the
            <code class="literal">session-management</code> element. </p>
        <p>If you are using a customized authentication filter for form-based login, then you
          have to configure concurrent session control support explicitly. More details can be found
          in the <a class="ulink" href="#session-mgmt" target="_top">Session Management chapter</a>. </p>
      </div>
      <div class="section" title="Session Fixation Attack Protection"><div class="titlepage"><div><div><h4 class="title"><a name="ns-session-fixation"></a>Session Fixation Attack Protection</h4></div></div></div>
        
        <p>
          <a class="ulink" href="http://en.wikipedia.org/wiki/Session_fixation" target="_top">Session fixation</a>
          attacks are a potential risk where it is possible for a malicious attacker to create a
          session by accessing a site, then persuade another user to log in with the same session
          (by sending them a link containing the session identifier as a parameter, for example).
          Spring Security protects against this automatically by creating a new session when a user
          logs in. If you don't require this protection, or it conflicts with some other
          requirement, you can control the behaviour using the
            <code class="literal">session-fixation-protection</code> attribute on
            <code class="literal">&lt;session-management&gt;</code>, which has three options
                  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="literal">migrateSession</code> - creates a new
                session and copies the existing session attributes to the new session. This is the
                default.</p></li><li class="listitem"><p><code class="literal">none</code> - Don't do
                anything. The original session will be
                  retained.</p></li><li class="listitem"><p><code class="literal">newSession</code> - Create
                a new "clean" session, without copying the existing session
            data.</p></li></ul></div>
      </div>
    </div>
    <div class="section" title="2.3.4&nbsp;OpenID Support"><div class="titlepage"><div><div><h3 class="title"><a name="ns-openid"></a>2.3.4&nbsp;OpenID Support</h3></div></div></div>
      
      <p>The namespace supports <a class="ulink" href="http://openid.net/" target="_top">OpenID</a> login either
        instead of, or in addition to normal form-based login, with a simple change: </p><pre class="programlisting">
  <span class="hl-tag">&lt;http&gt;</span>
    <span class="hl-tag">&lt;intercept-url</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"/**"</span> <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;openid-login /&gt;</span>
  <span class="hl-tag">&lt;/http&gt;</span>
</pre><p>You should then register yourself with an OpenID provider (such as
        myopenid.com), and add the user information to your in-memory
          <code class="literal">&lt;user-service&gt;</code> : </p><pre class="programlisting">
  <span class="hl-tag">&lt;user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"http://jimi.hendrix.myopenid.com/"</span> <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
</pre><p> You should be able to login using the <code class="literal">myopenid.com</code> site to
        authenticate. It is also possible to select a specific
          <code class="interfacename">UserDetailsService</code> bean for use OpenID by setting the
          <code class="literal">user-service-ref</code> attribute on the <code class="literal">openid-login</code>
        element. See the previous section on <a class="ulink" href="#ns-auth-providers" target="_top">authentication
          providers</a> for more information. Note that we have omitted the password attribute
        from the above user configuration, since this set of user data is only being used to load
        the authorities for the user. A random password will be generate internally, preventing you
        from accidentally using this user data as an authentication source elsewhere in your
        configuration.</p>
      <div class="section" title="Attribute Exchange"><div class="titlepage"><div><div><h4 class="title"><a name="d4e427"></a>Attribute Exchange</h4></div></div></div>
        
        <p>Support for OpenID <a class="ulink" href="http://openid.net/specs/openid-attribute-exchange-1_0.html" target="_top">attribute
            exchange</a>. As an example, the following configuration would attempt to retrieve
          the email and full name from the OpenID provider, for use by the application:</p><pre class="programlisting">
  <span class="hl-tag">&lt;openid-login&gt;</span>
    <span class="hl-tag">&lt;attribute-exchange&gt;</span>
      <span class="hl-tag">&lt;openid-attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"email"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"http://axschema.org/contact/email"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
      <span class="hl-tag">&lt;openid-attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"http://axschema.org/namePerson"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/attribute-exchange&gt;</span>
  <span class="hl-tag">&lt;/openid-login&gt;</span></pre><p>The <span class="quote">&#8220;<span class="quote">type</span>&#8221;</span> of each OpenID attribute is a URI,
          determined by a particular schema, in this case <a class="ulink" href="http://axschema.org/" target="_top">http://axschema.org/</a>. If an attribute must be retrieved for successful
          authentication, the <code class="literal">required</code> attribute can be set. The exact schema and
          attributes supported will depend on your OpenID provider. The attribute values are
          returned as part of the authentication process and can be accessed afterwards using the
          following
          code:</p><pre class="programlisting">OpenIDAuthenticationToken token = (OpenIDAuthenticationToken)SecurityContextHolder.getContext().getAuthentication();
List&lt;OpenIDAttribute&gt; attributes = token.getAttributes();</pre><p>The
            <code class="classname">OpenIDAttribute</code> contains the attribute type and the retrieved
          value (or values in the case of multi-valued attributes). We'll see more about how the
            <code class="classname">SecurityContextHolder</code> class is used when we look at core Spring
          Security components in the <a class="ulink" href="#core-components" target="_top">technical overview</a>
          chapter.</p>
      </div>
    </div>
    <div class="section" title="2.3.5&nbsp;Adding in Your Own Filters"><div class="titlepage"><div><div><h3 class="title"><a name="ns-custom-filters"></a>2.3.5&nbsp;Adding in Your Own Filters</h3></div></div></div>
      
      <p>If you've used Spring Security before, you'll know that the framework maintains a chain
        of filters in order to apply its services. You may want to add your own filters to the stack
        at particular locations or use a Spring Security filter for which there isn't currently a
        namespace configuration option (CAS, for example). Or you might want to use a customized
        version of a standard namespace filter, such as the
          <code class="literal">UsernamePasswordAuthenticationFilter</code> which is created by the
          <code class="literal">&lt;form-login&gt;</code> element, taking advantage of some of the extra
        configuration options which are available by using the bean explicitly. How can you do this
        with namespace configuration, since the filter chain is not directly exposed? </p>
      <p>The order of the filters is always strictly enforced when using the namespace. When the
        application context is being created, the filter beans are sorted by the namespace handling
        code and the standard Spring Security filters each have an alias in the namespace and a
        well-known position.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In previous versions, the sorting took place after the
            filter instances had been created, during post-processing of the application context. In
            version 3.0+ the sorting is now done at the bean metadata level, before the classes have
            been instantiated. This has implications for how you add your own filters to the stack
            as the entire filter list must be known during the parsing of the
              <code class="literal">&lt;http&gt;</code> element, so the syntax has changed slightly in
            3.0.</p></td></tr></table></div><p>The filters, aliases and namespace elements/attributes which create
        the filters are shown in <a class="xref" href="ns-config.html#filter-stack" title="Table&nbsp;2.1.&nbsp;Standard Filter Aliases and Ordering">Table&nbsp;2.1, &#8220;Standard Filter
            Aliases and Ordering&#8221;</a>. The filters are listed in the order
        in which they occur in the filter chain. </p><div class="table"><a name="filter-stack"></a><p class="title"><b>Table&nbsp;2.1.&nbsp;Standard Filter
            Aliases and Ordering</b></p><div class="table-contents"><table summary="Standard Filter&#xA;            Aliases and Ordering" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="center">Alias</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="center">Filter Class</th><th style="border-bottom: 0.5pt solid ; " align="center">Namespace Element or
                  Attribute</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                    CHANNEL_FILTER</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="literal">ChannelProcessingFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">http/intercept-url@requires-channel</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  CONCURRENT_SESSION_FILTER</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="literal">ConcurrentSessionFilter</code>
                </td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">session-management/concurrency-control</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  SECURITY_CONTEXT_FILTER</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="classname">SecurityContextPersistenceFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">http</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  LOGOUT_FILTER
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="literal">LogoutFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">http/logout</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  X509_FILTER
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="literal">X509AuthenticationFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">http/x509</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  PRE_AUTH_FILTER
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="literal">AstractPreAuthenticatedProcessingFilter</code>
                  Subclasses</td><td style="border-bottom: 0.5pt solid ; " align="left">N/A</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"> CAS_FILTER
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="literal">CasAuthenticationFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left">N/A</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  FORM_LOGIN_FILTER
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="literal">UsernamePasswordAuthenticationFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">http/form-login</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  BASIC_AUTH_FILTER
                  </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="literal">BasicAuthenticationFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">http/http-basic</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  SERVLET_API_SUPPORT_FILTER</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="literal">SecurityContextHolderAwareFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">http/@servlet-api-provision</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  REMEMBER_ME_FILTER
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="classname">RememberMeAuthenticationFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">http/remember-me</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  ANONYMOUS_FILTER
                  </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="literal">AnonymousAuthenticationFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">http/anonymous</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  SESSION_MANAGEMENT_FILTER</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="literal">SessionManagementFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">session-management</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">EXCEPTION_TRANSLATION_FILTER
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="classname">ExceptionTranslationFilter</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">http</code></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left">
                  FILTER_SECURITY_INTERCEPTOR
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left"><code class="classname">FilterSecurityInterceptor</code></td><td style="border-bottom: 0.5pt solid ; " align="left"><code class="literal">http</code></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left">
                  SWITCH_USER_FILTER
                  </td><td style="border-right: 0.5pt solid ; " align="left"><code class="literal">SwitchUserFilter</code></td><td style="" align="left">N/A</td></tr></tbody></table></div></div><p><br class="table-break">
        You can add your own filter to the stack, using the <code class="literal">custom-filter</code> element
        and one of these names to specify the position your filter should appear at: </p><pre class="programlisting">
  <span class="hl-tag">&lt;http&gt;</span>
     <span class="hl-tag">&lt;custom-filter</span> <span class="hl-attribute">position</span>=<span class="hl-value">"FORM_LOGIN_FILTER"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myFilter"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;/http&gt;</span>

  <span class="hl-tag">&lt;beans:bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myFilter"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MySpecialAuthenticationFilter"</span><span class="hl-tag">/&gt;</span>
  
  </pre><p> You can also use the <code class="literal">after</code> or <code class="literal">before</code>
        attributes if you want your filter to be inserted before or after another filter in the
        stack. The names "FIRST" and "LAST" can be used with the <code class="literal">position</code>
        attribute to indicate that you want your filter to appear before or after the entire stack,
        respectively. </p>
      <div class="tip" title="Avoiding filter position conflicts" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Avoiding filter position conflicts"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Avoiding filter position conflicts</th></tr><tr><td align="left" valign="top">
        
        <p> If you are inserting a custom filter which may occupy the same position as one of the
          standard filters created by the namespace then it's important that you don't include the
          namespace versions by mistake. Avoid using the <code class="literal">auto-config</code> attribute
          and remove any elements which create filters whose functionality you want to replace. </p>
        <p> Note that you can't replace filters which are created by the use of the
            <code class="literal">&lt;http&gt;</code> element itself -
            <code class="classname">SecurityContextPersistenceFilter</code>,
            <code class="classname">ExceptionTranslationFilter</code> or
            <code class="classname">FilterSecurityInterceptor</code>. </p>
      </td></tr></table></div>
      <p> If you're replacing a namespace filter which requires an authentication entry point
        (i.e. where the authentication process is triggered by an attempt by an unauthenticated user
        to access to a secured resource), you will need to add a custom entry point bean too. </p>
      <div class="section" title="Setting a Custom AuthenticationEntryPoint"><div class="titlepage"><div><div><h4 class="title"><a name="ns-entry-point-ref"></a>Setting a Custom <code class="interfacename">AuthenticationEntryPoint</code></h4></div></div></div>
        
        <p> If you aren't using form login, OpenID or basic authentication through the namespace,
          you may want to define an authentication filter and entry point using a traditional bean
          syntax and link them into the namespace, as we've just seen. The corresponding
            <code class="interfacename">AuthenticationEntryPoint</code> can be set using the
            <code class="literal">entry-point-ref</code> attribute on the <code class="literal">&lt;http&gt;</code>
          element. </p>
        <p> The CAS sample application is a good example of the use of custom beans with the
          namespace, including this syntax. If you aren't familiar with authentication entry points,
          they are discussed in the <a class="ulink" href="#tech-intro-auth-entry-point" target="_top">technical
            overview</a> chapter. </p>
      </div>
    </div>
  </div>
  <div class="section" title="2.4&nbsp;Method Security"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ns-method-security"></a>2.4&nbsp;Method Security</h2></div></div></div>
    
    <p>From version 2.0 onwards Spring Security has improved support substantially for adding
      security to your service layer methods. It provides support for JSR-250 annotation security as
      well as the framework's original <code class="literal">@Secured</code> annotation. From 3.0 you can also
      make use of new <a class="ulink" href="#el-access" target="_top">expression-based annotations</a>. You can
      apply security to a single bean, using the <code class="literal">intercept-methods</code> element to
      decorate the bean declaration, or you can secure multiple beans across the entire service
      layer using the AspectJ style pointcuts. </p>
    <div class="section" title="2.4.1&nbsp;The <global-method-security&gt; Element"><div class="titlepage"><div><div><h3 class="title"><a name="ns-global-method"></a>2.4.1&nbsp;The <code class="literal">&lt;global-method-security&gt;</code> Element</h3></div></div></div>
      
      <p> This element is used to enable annotation-based security in your application (by
        setting the appropriate attributes on the element), and also to group together security
        pointcut declarations which will be applied across your entire application context. You
        should only declare one <code class="literal">&lt;global-method-security&gt;</code> element. The
        following declaration would enable support for Spring Security's
        <code class="literal">@Secured</code>: </p><pre class="programlisting">
  &lt;global-method-security secured-annotations="enabled" /&gt;
  
</pre><p> Adding an annotation to a method (on an class or interface) would then limit
        the access to that method accordingly. Spring Security's native annotation support defines a
        set of attributes for the method. These will be passed to the
          <code class="interfacename">AccessDecisionManager</code> for it to make the actual decision:
        </p><pre class="programlisting">
  <span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> BankService {

    <i><span class="hl-annotation" style="color: gray">@Secured("IS_AUTHENTICATED_ANONYMOUSLY")</span></i>
    <span class="hl-keyword">public</span> Account readAccount(Long id);

    <i><span class="hl-annotation" style="color: gray">@Secured("IS_AUTHENTICATED_ANONYMOUSLY")</span></i>
    <span class="hl-keyword">public</span> Account[] findAccounts();

    <i><span class="hl-annotation" style="color: gray">@Secured("ROLE_TELLER")</span></i>
    <span class="hl-keyword">public</span> Account post(Account account, <span class="hl-keyword">double</span> amount);
  }
</pre><p>Support
        for JSR-250 annotations can be enabled using </p><pre class="programlisting">
  &lt;global-method-security jsr250-annotations="enabled" /&gt;
  
        </pre><p>These are standards-based and allow simple role-based constraints to be
        applied but do not have the power Spring Security's native annotations.
        To use the new expression-based syntax, you would use
</p><pre class="programlisting">
  &lt;global-method-security pre-post-annotations="enabled" /&gt;
  </pre><p>and the equivalent Java code would
        be</p><pre class="programlisting">
   <span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> BankService {

     <i><span class="hl-annotation" style="color: gray">@PreAuthorize("isAnonymous()")</span></i>
     <span class="hl-keyword">public</span> Account readAccount(Long id);

     <i><span class="hl-annotation" style="color: gray">@PreAuthorize("isAnonymous()")</span></i>
     <span class="hl-keyword">public</span> Account[] findAccounts();

     <i><span class="hl-annotation" style="color: gray">@PreAuthorize("hasAuthority('ROLE_TELLER')")</span></i>
     <span class="hl-keyword">public</span> Account post(Account account, <span class="hl-keyword">double</span> amount);
   }
        </pre><p>Expression-based
        annotations are a good choice if you need to define simple rules that go beyond checking the
        role names against the user's list of authorities. You can enable more than one type of
        annotation in the same application, but you should avoid mixing annotations types in the
        same interface or class to avoid confusion.</p>
      <div class="section" title="Adding Security Pointcuts using protect-pointcut"><div class="titlepage"><div><div><h4 class="title"><a name="ns-protect-pointcut"></a>Adding Security Pointcuts using <code class="literal">protect-pointcut</code></h4></div></div></div>
        
        <p> The use of <code class="literal">protect-pointcut</code> is particularly powerful, as it allows
          you to apply security to many beans with only a simple declaration. Consider the following
          example: </p><pre class="programlisting">
  <span class="hl-tag">&lt;global-method-security&gt;</span>
    <span class="hl-tag">&lt;protect-pointcut</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.mycompany.*Service.*(..))"</span>
         <span class="hl-attribute">access</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/global-method-security&gt;</span>

          </pre><p> This will protect all methods on beans declared in the application
          context whose classes are in the <code class="literal">com.mycompany</code> package and whose class
          names end in "Service". Only users with the <code class="literal">ROLE_USER</code> role will be able
          to invoke these methods. As with URL matching, the most specific matches must come first
          in the list of pointcuts, as the first matching expression will be used. </p>
      </div>
    </div>
  </div>
  <div class="section" title="2.5&nbsp;The Default AccessDecisionManager"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ns-access-manager"></a>2.5&nbsp;The Default AccessDecisionManager</h2></div></div></div>
    
    <p> This section assumes you have some knowledge of the underlying architecture for
      access-control within Spring Security. If you don't you can skip it and come back to it later,
      as this section is only really relevant for people who need to do some customization in order
      to use more than simple role-based security. </p>
    <p> When you use a namespace configuration, a default instance of
        <code class="interfacename">AccessDecisionManager</code> is automatically registered for you and
      will be used for making access decisions for method invocations and web URL access, based on
      the access attributes you specify in your <code class="literal">intercept-url</code> and
        <code class="literal">protect-pointcut</code> declarations (and in annotations if you are using
      annotation secured methods). </p>
    <p> The default strategy is to use an <code class="classname">AffirmativeBased</code>
      <code class="interfacename">AccessDecisionManager</code> with a <code class="classname">RoleVoter</code>
      and an <code class="classname">AuthenticatedVoter</code>. You can find out more about these in the
      chapter on <a class="ulink" href="authorization" target="_top">authorization</a>.</p>
    <div class="section" title="2.5.1&nbsp;Customizing the AccessDecisionManager"><div class="titlepage"><div><div><h3 class="title"><a name="ns-custom-access-mgr"></a>2.5.1&nbsp;Customizing the AccessDecisionManager</h3></div></div></div>
      
      <p> If you need to use a more complicated access control strategy then it is easy to set an
        alternative for both method and web security. </p>
      <p> For method security, you do this by setting the
          <code class="literal">access-decision-manager-ref</code> attribute on
          <code class="literal">global-method-security</code> to the Id of the appropriate
          <code class="interfacename">AccessDecisionManager</code> bean in the application context: </p><pre class="programlisting">
  <span class="hl-tag">&lt;global-method-security</span> <span class="hl-attribute">access-decision-manager-ref</span>=<span class="hl-value">"myAccessDecisionManagerBean"</span><span class="hl-tag">&gt;</span>
    ...
  <span class="hl-tag">&lt;/global-method-security&gt;</span>
  </pre>
      <p> The syntax for web security is the same, but on the <code class="literal">http</code> element: </p><pre class="programlisting">
  <span class="hl-tag">&lt;http</span> <span class="hl-attribute">access-decision-manager-ref</span>=<span class="hl-value">"myAccessDecisionManagerBean"</span><span class="hl-tag">&gt;</span>
    ...
  <span class="hl-tag">&lt;/http&gt;</span>
  </pre>
    </div>
  </div>
  <div class="section" title="2.6&nbsp;The Authentication Manager and the Namespace"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ns-auth-manager"></a>2.6&nbsp;The Authentication Manager and the Namespace</h2></div></div></div>
    
    <p> The main interface which provides authentication services in Spring Security is the
        <code class="interfacename">AuthenticationManager</code>. This is usually an instance of Spring
      Security's <code class="classname">ProviderManager</code> class, which you may already be familiar
      with if you've used the framework before. If not, it will be covered later, in the <a class="ulink" href="#tech-intro-authentication" target="_top">technical overview chapter</a>. The bean instance
      is registered using the <code class="literal">authentication-manager</code> namespace element. You can't
      use a custom <code class="classname">AuthenticationManager</code> if you are using either HTTP or
      method security through the namespace, but this should not be a problem as you have full
      control over the <code class="classname">AuthenticationProvider</code>s that are used.</p>
    <p> You may want to register additional <code class="classname">AuthenticationProvider</code> beans
      with the <code class="classname">ProviderManager</code> and you can do this using the
        <code class="literal">&lt;authentication-provider&gt;</code> element with the <code class="literal">ref</code>
      attribute, where the value of the attribute is the name of the provider bean you want to add.
      For example: </p><pre class="programlisting">
  <span class="hl-tag">&lt;authentication-manager&gt;</span>
    <span class="hl-tag">&lt;authentication-provider</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"casAuthenticationProvider"</span><span class="hl-tag">/&gt;</span>
  <span class="hl-tag">&lt;/authentication-manager&gt;</span>

  <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"casAuthenticationProvider"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.security.cas.authentication.CasAuthenticationProvider"</span><span class="hl-tag">&gt;</span>
    ...
  <span class="hl-tag">&lt;/bean&gt;</span>
  </pre>
    <p> Another common requirement is that another bean in the context may require a reference to
      the <code class="interfacename">AuthenticationManager</code>. You can easily register an alias for
      the <code class="interfacename">AuthenticationManager</code> and use this name elsewhere in your
      application context. </p><pre class="programlisting">
  <span class="hl-tag">&lt;security:authentication-manager</span> <span class="hl-attribute">alias</span>=<span class="hl-value">"authenticationManager"</span><span class="hl-tag">&gt;</span>
     ...
  <span class="hl-tag">&lt;/security:authentication-manager&gt;</span>

  <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"customizedFormLoginFilter"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"com.somecompany.security.web.CustomFormLoginFilter"</span><span class="hl-tag">&gt;</span>
     <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"authenticationManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"authenticationManager"</span><span class="hl-tag">/&gt;</span>
     ...
  <span class="hl-tag">&lt;/bean&gt;</span>
  </pre>
  </div>
<div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d4e201" href="#d4e201" class="para">1</a>] </sup>You can find
          out more about the use of the <code class="literal">ldap-server</code> element in the chapter on
            <a class="ulink" href="#ldap" target="_top">LDAP</a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d4e257" href="#d4e257" class="para">2</a>] </sup>The
            interpretation of the comma-separated values in the <code class="literal">access</code> attribute
            depends on the implementation of the <a class="ulink" href="#ns-access-manager" target="_top">AccessDecisionManager</a> which is used. In Spring Security 3.0, the attribute can
            also be populated with an <a class="ulink" href="#el-access" target="_top">EL
          expression</a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d4e299" href="#d4e299" class="para">3</a>] </sup>In versions prior
              to 3.0, this list also included remember-me functionality. This could cause some
              confusing errors with some configurations and was removed in 3.0. In 3.0, the addition
              of an <code class="classname">AnonymousAuthenticationFilter</code> is part of the default
                <code class="literal">&lt;http&gt;</code> configuration, so the <code class="literal">&lt;anonymous
                /&gt;</code> element is added regardless of whether <code class="literal">auto-config</code>
              is enabled.</p></div><div class="footnote"><p><sup>[<a name="ftn.d4e312" href="#d4e312" class="para">4</a>] </sup>See the
              chapter on <a class="ulink" href="#anonymous" target="_top">anonymous authentication</a> and also the
                <a class="ulink" href="#authz-authenticated-voter" target="_top">AuthenticatedVoter</a> class for
              more details on how the value <code class="literal">IS_AUTHENTICATED_ANONYMOUSLY</code> is
              processed.</p></div></div></div><!--Begin LoopFuse code--><script src="http://loopfuse.net/webrecorder/js/listen.js" type="text/javascript"></script><script type="text/javascript">
			_lf_cid = "LF_48be82fa";
			_lf_remora();
		</script><!--End LoopFuse code--><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="introduction.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="getting-started.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="sample-apps.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1.&nbsp;Introduction&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="springsecurity.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;3.&nbsp;Sample Applications</td></tr></table></div></body></html>